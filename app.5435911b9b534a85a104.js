(()=>{"use strict";(()=>{function e(){}function t(e){return e()}function s(){return Object.create(null)}function n(e){e.forEach(t)}function i(e){return"function"==typeof e}function o(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let a;function l(e,t){return a||(a=document.createElement("a")),a.href=t,e===a.href}function c(e){return 0===Object.keys(e).length}function r(e,t,s,n){return e[1]&&n?function(e,t){for(const s in t)e[s]=t[s];return e}(s.ctx.slice(),e[1](n(t))):s.ctx}new Set;let u,h=!1;function d(e,t,s){e.insertBefore(t,s||null)}function f(e){e.parentNode.removeChild(e)}function m(e){return document.createElement(e)}function p(e){return document.createTextNode(e)}function g(){return p(" ")}function y(e,t,s,n){return e.addEventListener(t,s,n),()=>e.removeEventListener(t,s,n)}function b(e,t,s){null==s?e.removeAttribute(t):e.getAttribute(t)!==s&&e.setAttribute(t,s)}function $(e){u=e}function v(){if(!u)throw new Error("Function called outside component initialization");return u}function k(e,t){const s=e.$$.callbacks[t.type];s&&s.slice().forEach((e=>e.call(this,t)))}new Set;const _=[],M=[],w=[],C=[],T=Promise.resolve();let A=!1;function x(e){w.push(e)}let N=!1;const R=new Set;function S(){if(!N){N=!0;do{for(let e=0;e<_.length;e+=1){const t=_[e];$(t),E(t.$$)}for($(null),_.length=0;M.length;)M.pop()();for(let e=0;e<w.length;e+=1){const t=w[e];R.has(t)||(R.add(t),t())}w.length=0}while(_.length);for(;C.length;)C.pop()();A=!1,N=!1,R.clear()}}function E(e){if(null!==e.fragment){e.update(),n(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(x)}}const U=new Set;let H,I;function P(e,t){e&&e.i&&(U.delete(e),e.i(t))}function j(e,t,s,n){if(e&&e.o){if(U.has(e))return;U.add(e),H.c.push((()=>{U.delete(e),n&&(s&&e.d(1),n())})),e.o(t)}}function z(e,t){const s=t.token={};function i(e,i,o,a){if(t.token!==s)return;t.resolved=a;let l=t.ctx;void 0!==o&&(l=l.slice(),l[o]=a);const c=e&&(t.current=e)(l);let r=!1;t.block&&(t.blocks?t.blocks.forEach(((e,s)=>{s!==i&&e&&(H={r:0,c:[],p:H},j(e,1,1,(()=>{t.blocks[s]===e&&(t.blocks[s]=null)})),H.r||n(H.c),H=H.p)})):t.block.d(1),c.c(),P(c,1),c.m(t.mount(),t.anchor),r=!0),t.block=c,t.blocks&&(t.blocks[i]=c),r&&S()}if((o=e)&&"object"==typeof o&&"function"==typeof o.then){const s=v();if(e.then((e=>{$(s),i(t.then,1,t.value,e),$(null)}),(e=>{if($(s),i(t.catch,2,t.error,e),$(null),!t.hasCatch)throw e})),t.current!==t.pending)return i(t.pending,0),!0}else{if(t.current!==t.then)return i(t.then,1,t.value,e),!0;t.resolved=e}var o}function K(e,s,o,a){const{fragment:l,on_mount:c,on_destroy:r,after_update:u}=e.$$;l&&l.m(s,o),a||x((()=>{const s=c.map(t).filter(i);r?r.push(...s):n(s),e.$$.on_mount=[]})),u.forEach(x)}function L(e,t){const s=e.$$;null!==s.fragment&&(n(s.on_destroy),s.fragment&&s.fragment.d(t),s.on_destroy=s.fragment=null,s.ctx=[])}function q(t,i,o,a,l,c,r,d=[-1]){const m=u;$(t);const p=t.$$={fragment:null,ctx:null,props:c,update:e,not_equal:l,bound:s(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(m?m.$$.context:[])),callbacks:s(),dirty:d,skip_bound:!1,root:i.target||m.$$.root};r&&r(p.root);let g=!1;if(p.ctx=o?o(t,i.props||{},((e,s,...n)=>{const i=n.length?n[0]:s;return p.ctx&&l(p.ctx[e],p.ctx[e]=i)&&(!p.skip_bound&&p.bound[e]&&p.bound[e](i),g&&function(e,t){-1===e.$$.dirty[0]&&(_.push(e),A||(A=!0,T.then(S)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(t,e)),s})):[],p.update(),g=!0,n(p.before_update),p.fragment=!!a&&a(p.ctx),i.target){if(i.hydrate){h=!0;const e=(y=i.target,Array.from(y.childNodes));p.fragment&&p.fragment.l(e),e.forEach(f)}else p.fragment&&p.fragment.c();i.intro&&P(t.$$.fragment),K(t,i.target,i.anchor,i.customElement),h=!1,S()}var y;$(m)}"undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global,new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),"function"==typeof HTMLElement&&(I=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:e}=this.$$;this.$$.on_disconnect=e.map(t).filter(i);for(const e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(e,t,s){this[e]=s}disconnectedCallback(){n(this.$$.on_disconnect)}$destroy(){L(this,1),this.$destroy=e}$on(e,t){const s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(t),()=>{const e=s.indexOf(t);-1!==e&&s.splice(e,1)}}$set(e){this.$$set&&!c(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}});class O{$destroy(){L(this,1),this.$destroy=e}$on(e,t){const s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(t),()=>{const e=s.indexOf(t);-1!==e&&s.splice(e,1)}}$set(e){this.$$set&&!c(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}class B{constructor(e){this.kosyClient=window.parent,this.latestMessageNumber=0,this.kosyApp=e}dictionaryToArray(e){let t=[];for(const s in e)e.hasOwnProperty(s)&&t.push([s,e[s]]);return t}startApp(){return this.initialInfoPromise=new Promise(((e,t)=>{window.addEventListener("message",(t=>{let s=t.data;switch(s.type){case"receive-initial-info":this.latestMessageNumber=s.latestMessageNumber,this.clients=s.payload.clients,this.hostClientUuid=s.payload.initializerClientUuid,this.log("Resolving initial info promise with: ",s.payload),e(s.payload);break;case"set-client-info":{let e=s.clients,t=s.hostClientUuid;this.initialInfoPromise.then((s=>{let n=this.dictionaryToArray(e).filter((e=>!this.clients[e[0]])),i=this.dictionaryToArray(this.clients).filter((t=>!e[t[0]])),o=this.latestMessageNumber;this.hostClientUuid!==t&&this._relayMessageToClients(s,{type:"_host-has-changed",clientUuid:t},++o),n.forEach((e=>this._relayMessageToClients(s,{type:"_client-has-joined",clientInfo:e[1]},++o))),i.forEach((e=>this._relayMessageToClients(s,{type:"_client-has-left",clientUuid:e[0]},++o))),this.clients=e,this.hostClientUuid=t}));break}case"get-app-state":{let e=s.clientUuids;this.log("Get app state received -> sending app state");const t=this.kosyApp.onRequestState();this._sendMessageToKosy({type:"receive-app-state",state:t,clientUuids:e,latestMessageNumber:this.latestMessageNumber});break}case"set-app-state":this.latestMessageNumber=s.latestMessageNumber;let t=s.state;this.initialInfoPromise.then((()=>{this.log("Received app state from Kosy -> setting app state"),this.kosyApp.onProvideState(t)}));break;case"receive-message-as-host":this._handleReceiveMessageAsHost(s);break;case"receive-message-as-client":this._handleReceiveMessageAsClient(s)}})),this._sendMessageToKosy({type:"ready-and-listening"})})),this.initialInfoPromise}stopApp(){this._sendMessageToKosy({type:"stop-app"})}relayMessage(e){this.log("Relaying client message to host: ",e),this._sendMessageToKosy({type:"relay-message-to-host",message:e})}_relayMessageToClients(e,t,s){this.log("Relaying host to client message: ",t),this._sendMessageToKosy({type:"relay-message-to-clients",sentByClientUuid:e.currentClientUuid,message:t,messageNumber:s})}_sendMessageToKosy(e){this.kosyClient.postMessage(e,"*")}_handleReceiveMessageAsClientRecursive(e,t,s){var n,i,o,a,l,c;if(this.latestMessageNumber===e.messageNumber-1){switch(e.message.type){case"_host-has-changed":{let t=e.message.clientUuid;this.hostClientUuid=t,null===(i=(n=this.kosyApp).onHostHasChanged)||void 0===i||i.call(n,t);break}case"_client-has-joined":{let t=e.message.clientInfo;this.clients[t.clientUuid]=t,null===(a=(o=this.kosyApp).onClientHasJoined)||void 0===a||a.call(o,t);break}case"_client-has-left":{let t=e.message.clientUuid;this.clients[t]=null,null===(c=(l=this.kosyApp).onClientHasLeft)||void 0===c||c.call(l,t);break}default:this.kosyApp.onReceiveMessageAsClient(e.message)}this.latestMessageNumber=e.messageNumber}else s<50&&this.latestMessageNumber<e.messageNumber?setTimeout((()=>this._handleReceiveMessageAsClientRecursive(e,t,s+1)),100):(this.log("Timeout on processing message as client: ",e.message),this.log("Wait for Kosy to fix this mess..."))}_handleReceiveMessageAsClient(e){this.initialInfoPromise.then((t=>{this.log("Received message as client, processing: ",e.message),this._handleReceiveMessageAsClientRecursive(e,t,0)}))}_handleReceiveMessageAsHost(e){this.initialInfoPromise.then((t=>{this.log("Trying to handle message as host");const s=this.kosyApp.onReceiveMessageAsHost(e.message);s&&this._relayMessageToClients(t,s,this.latestMessageNumber+1)}))}log(...e){"1"===localStorage.getItem("debug-mode")&&console.log("From kosy-app-api: ",...e)}}function F(e){let t,s,i,o;const a=e[5].default,l=function(e,t,s,n){if(e){const n=r(e,t,s,null);return e[0](n)}}(a,e,e[4]);return{c(){t=m("button"),l&&l.c(),b(t,"class",e[1]),t.disabled=e[0]},m(n,a){d(n,t,a),l&&l.m(t,null),s=!0,i||(o=[y(t,"click",e[6]),y(t,"dblclick",e[7]),y(t,"focus",e[8])],i=!0)},p(e,[n]){l&&l.p&&(!s||16&n)&&function(e,t,s,n,i,o){if(i){const a=r(t,s,n,o);e.p(a,i)}}(l,a,e,e[4],s?function(e,t,s,n){if(e[2]&&n){const i=e[2](n(s));if(void 0===t.dirty)return i;if("object"==typeof i){const e=[],s=Math.max(t.dirty.length,i.length);for(let n=0;n<s;n+=1)e[n]=t.dirty[n]|i[n];return e}return t.dirty|i}return t.dirty}(a,e[4],n,null):function(e){if(e.ctx.length>32){const t=[],s=e.ctx.length/32;for(let e=0;e<s;e++)t[e]=-1;return t}return-1}(e[4]),null),(!s||2&n)&&b(t,"class",e[1]),(!s||1&n)&&(t.disabled=e[0])},i(e){s||(P(l,e),s=!0)},o(e){j(l,e),s=!1},d(e){e&&f(t),l&&l.d(e),i=!1,n(o)}}}function W(e,t,s){let{$$slots:n={},$$scope:i}=t,{size:o="regular"}=t,{importance:a}=t,{disabled:l=!1}=t,c="";return e.$$set=e=>{"size"in e&&s(2,o=e.size),"importance"in e&&s(3,a=e.importance),"disabled"in e&&s(0,l=e.disabled),"$$scope"in e&&s(4,i=e.$$scope)},e.$$.update=()=>{if(12&e.$$.dirty){let e=["re-button","size-"+o];a&&e.push("importance-"+a),s(1,c=e.join(" "))}},[l,c,o,a,i,n,function(t){k.call(this,e,t)},function(t){k.call(this,e,t)},function(t){k.call(this,e,t)}]}const G=class extends O{constructor(e){super(),q(this,e,W,F,o,{size:2,importance:3,disabled:0})}};function Q(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function J(e){let t,s,n,i,o,a,c,r=e[1]&&D();return a=new G({props:{importance:"secondary",size:"small",$$slots:{default:[V]},$$scope:{ctx:e}}}),a.$on("click",e[4]),{c(){var c;t=m("iframe"),n=g(),r&&r.c(),i=g(),o=m("div"),(c=a.$$.fragment)&&c.c(),b(t,"title","codenames iframe"),l(t.src,s=e[0])||b(t,"src",s),b(t,"class","svelte-12hnfih"),b(o,"class","bottom-bar svelte-12hnfih")},m(e,s){d(e,t,s),d(e,n,s),r&&r.m(e,s),d(e,i,s),d(e,o,s),K(a,o,null),c=!0},p(e,n){(!c||1&n&&!l(t.src,s=e[0]))&&b(t,"src",s),e[1]?r||(r=D(),r.c(),r.m(i.parentNode,i)):r&&(r.d(1),r=null);const o={};1024&n&&(o.$$scope={dirty:n,ctx:e}),a.$set(o)},i(e){c||(P(a.$$.fragment,e),c=!0)},o(e){j(a.$$.fragment,e),c=!1},d(e){e&&f(t),e&&f(n),r&&r.d(e),e&&f(i),e&&f(o),L(a)}}}function D(e){let t;return{c(){t=m("div"),t.innerHTML='<div class="svelte-12hnfih"><h3>What is the goal?</h3> \n                    <ol><li>Players split into 2 teams: Blue &amp; Red, with each team assigning a Spymaster. Rest of the team are Field Operatives.</li> \n                        <li>The Spymasters go in Spymaster mode in bottom right corner. Spymasters of each team can check agents’ team color hiding behind the codenames.</li> \n                        <li>Spymasters must guide each team to guess the codenames of their team’s agents by providing a clue to them.</li> \n                        <li>Teams use the clue to guess the right codenames related to their team’s agents</li> \n                        <li>Winning team is the team that uncovers the identities of all their agents</li></ol> \n                    <h3>Gameplay</h3> \n                    <span>Teams take turns to do the following:</span> \n                    <ol><li>The team’s Spymaster gives clues:</li> \n                        <li class="margin-left svelte-12hnfih">Spymaster selects the codenames he/she would like the field operatives to uncover</li> \n                        <li class="margin-left svelte-12hnfih">Spymaster gives a one-word clue and shouts out the number of codenames it relates to. This number will indicate the number of correct guesses the team can make for the turn. If the team makes a correct guess form previous clue, they are allowed 1 extra guess</li> \n                        <li>Team’s field operatives guess the codenames to uncover:</li> \n                        <li class="margin-left svelte-12hnfih">Teammates discuss the clue and make a guess by touching one of the codenames on the table</li> \n                        <li class="margin-left svelte-12hnfih">If it uncovers an agent belonging to the team, they continue guessing until they uncover all codenames related to the clue</li> \n                        <li>The turn is passed to the next team, if any of the guesses are wrong</li> \n                        <li>Team loses if they uncover an Assassin card.</li></ol></div>',b(t,"class","pop-up svelte-12hnfih")},m(e,s){d(e,t,s)},d(e){e&&f(t)}}}function V(e){let t,s,n;return{c(){t=m("img"),n=p("\n                How to play"),b(t,"class","icon-left"),l(t.src,s="assets/Question-icon.png")||b(t,"src","assets/Question-icon.png"),b(t,"alt","question-mark")},m(e,s){d(e,t,s),d(e,n,s)},d(e){e&&f(t),e&&f(n)}}}function X(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function Y(e){let t,s,n,i={ctx:e,current:null,token:null,hasCatch:!1,pending:X,then:J,catch:Q,value:9,blocks:[,,,]};return z(s=e[2],i),{c(){t=m("main"),i.block.c(),b(t,"class","svelte-12hnfih")},m(e,s){d(e,t,s),i.block.m(t,i.anchor=null),i.mount=()=>t,i.anchor=null,n=!0},p(t,[s]){!function(e,t,s){const n=t.slice(),{resolved:i}=e;e.current===e.then&&(n[e.value]=i),e.current===e.catch&&(n[e.error]=i),e.block.p(n,s)}(i,e=t,s)},i(e){n||(P(i.block),n=!0)},o(e){for(let e=0;e<3;e+=1)j(i.blocks[e]);n=!1},d(e){e&&f(t),i.block.d(),i.token=null,i=null}}}function Z(e,t,s){let n,i={},o=!1,a=new B({onReceiveMessageAsHost:e=>e,onReceiveMessageAsClient:e=>{},onRequestState:()=>i,onProvideState:e=>(e=>{e&&(i=e)})(e)}).startApp().then((e=>{const t=e.clients[e.currentClientUuid].clientLocation;s(0,n=`https://www.horsepaste.com/kosy_${t.building.buildingName}_${t.floor.floorName}_${t.room.roomName}_${t.table.tableName}`)}));const l=()=>s(1,o=!o);return[n,o,a,l,()=>l()]}new class extends O{constructor(e){super(),q(this,e,Z,Y,o,{})}}({target:document.getElementById("container"),props:{}})})()})();